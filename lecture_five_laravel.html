<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Notifications | Advanced</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/4f50f622f4.js" crossorigin="anonymous"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="css/lecture-notifications.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html"><i class="fa-solid fa-code me-2"></i>Youssef Khaled</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="fa-solid fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html"><i class="fa-solid fa-home me-1"></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="learning.html"><i class="fa-solid fa-graduation-cap me-1"></i>Learning</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="lecture-hero">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html" class="text-white-50">Home</a></li>
                    <li class="breadcrumb-item"><a href="learning.html" class="text-white-50">Learning Tracks</a></li>
                    <li class="breadcrumb-item active text-white" aria-current="page">Notifications</li>
                </ol>
            </nav>
            <h1 class="display-5 fw-bold">Laravel Notifications</h1>
            <p class="lead mb-4">Send multi-channel notifications: mail, database, Slack, SMS; queue them, localize content, throttle delivery, and test confidently.</p>
            <div class="d-flex flex-wrap gap-2 align-items-center">
                <span class="badge rounded-pill bg-info-subtle text-info"><i class="fas fa-signal me-1"></i>Difficulty: Intermediate/Advanced</span>
                <span class="badge rounded-pill bg-warning-subtle text-warning"><i class="fas fa-clock me-1"></i>Duration: 60 min</span>
                <span class="badge rounded-pill bg-success-subtle text-success"><i class="fas fa-envelope me-1"></i>Mail</span>
                <span class="badge rounded-pill bg-primary-subtle text-primary"><i class="fas fa-bell me-1"></i>Notifications</span>
                <button id="markCompletedBtn" class="btn btn-outline-light ms-auto"><i class="far fa-check-circle me-2"></i>Mark as Completed</button>
            </div>
        </div>
    </header>

    <main class="container content-container">
        <section class="mb-5" data-aos="fade-up">
            <h2 class="section-title"><i class="fas fa-info-circle me-2"></i>Introduction</h2>
            <p>Centralize user communications with Laravel Notifications. We’ll cover channels, queueing, markdown mail, routing, localization, throttling, and testing.</p>
            <div class="arabic-explain">
                <strong>يعني إيه Notification؟</strong>
                <p>زي رسالة بتجيلك من البنك: ساعات إيميل، ساعات SMS، وساعات إشعار في التطبيق. نفس المعلومة بس بقنوات مختلفة حسب الموقف.</p>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="50">
            <h2 class="section-title"><i class="fas fa-layer-group me-2"></i>Main Concepts</h2>
            <div class="accordion" id="conceptsAccordion">
                <!-- Notifiable & Basic Notification -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingBasic">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBasic" aria-expanded="true" aria-controls="collapseBasic">
                            Notifiable model and a basic notification
                        </button>
                    </h2>
                    <div id="collapseBasic" class="accordion-collapse collapse show" aria-labelledby="headingBasic" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-bash">php artisan make:notification InvoicePaid</code></pre>
                            </div>
                            <div class="code-block">
<pre><code class="language-php">// app/Models/User.php
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
    use Notifiable;
}</code></pre>
                            </div>
                            <div class="code-block">
<pre><code class="language-php">// app/Notifications/InvoicePaid.php
namespace App\Notifications;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Notifications\Messages\MailMessage;
use Illuminate\Notifications\Notification;

class InvoicePaid extends Notification implements ShouldQueue
{
    use Queueable;

    public function via($notifiable): array
    {
        return ['mail', 'database'];
    }

    public function toMail($notifiable): MailMessage
    {
        return (new MailMessage)
            ->subject('Your invoice is paid')
            ->greeting('Hello '.$notifiable->name)
            ->line('Thanks for your payment!')
            ->action('View Invoice', url('/invoices'))
            ->line('We appreciate your business.');
    }

    public function toArray($notifiable): array
    {
        return ['type' => 'invoice', 'status' => 'paid'];
    }
}</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li><code>Notifiable</code> adds helper methods like <code>notify()</code>.</li>
                                <li>Multiple channels at once: mail + database.</li>
                                <li><code>ShouldQueue</code> queues the notification for performance.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>ليه بنستخدم Queue هنا؟</strong>
                                <p>علشان المستخدم ياخد رد سريع، وبعدين الإرسال يحصل في الخلفية بدون ما يطوّل الطلب.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Markdown Mail -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingMarkdown">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMarkdown" aria-expanded="false" aria-controls="collapseMarkdown">
                            Markdown mail templates and theming
                        </button>
                    </h2>
                    <div id="collapseMarkdown" class="accordion-collapse collapse" aria-labelledby="headingMarkdown" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-bash">php artisan vendor:publish --tag=laravel-mail</code></pre>
                            </div>
                            <div class="code-block">
<pre><code class="language-php">// app/Notifications/InvoicePaid.php (markdown)
public function toMail($notifiable)
{
    return (new MailMessage)
        ->subject('Invoice Paid')
        ->markdown('mail.invoice.paid', ['user' => $notifiable]);
}</code></pre>
                            </div>
                            <div class="arabic-explain">
                                <strong>Markdown؟</strong>
                                <p>زي قوالب جاهزة بتديك شكل جميل بسرعة، وتقدر تعدلها عشان البراند بتاعك.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Slack & SMS -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingSlackSms">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSlackSms" aria-expanded="false" aria-controls="collapseSlackSms">
                            Slack and SMS channels
                        </button>
                    </h2>
                    <div id="collapseSlackSms" class="accordion-collapse collapse" aria-labelledby="headingSlackSms" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// Slack route
public function routeNotificationForSlack($notification)
{
    return config('services.slack.webhook_url');
}

// app/Notifications/SystemAlert.php
use Illuminate\Notifications\Messages\SlackMessage;

public function toSlack($notifiable)
{
    return (new SlackMessage)
        ->error()
        ->content('Critical error!')
        ->attachment(fn($a) => $a->title('Stack Trace')->content('...'));
}</code></pre>
                            </div>
                            <div class="code-block">
<pre><code class="language-php">// Vonage (formerly Nexmo) SMS
use Illuminate\Notifications\Messages\VonageMessage;

public function toVonage($notifiable)
{
    return (new VonageMessage)
        ->content('Your OTP is 123456');
}

// Route phone per user
public function routeNotificationForVonage($notification)
{
    return $this->phone_number;
}</code></pre>
                            </div>
                            <div class="arabic-explain">
                                <strong>نختار قناة إزاي؟</strong>
                                <p>حسب أهمية الرسالة وسرعتها وتكلفتها. تنبيه خطير؟ Slack أو SMS. فاتورة شهرية؟ إيميل وقاعدة بيانات.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Database channel & In-app notifications -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingDatabase">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDatabase" aria-expanded="false" aria-controls="collapseDatabase">
                            Database channel and in-app feed
                        </button>
                    </h2>
                    <div id="collapseDatabase" class="accordion-collapse collapse" aria-labelledby="headingDatabase" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-bash">php artisan notifications:table
php artisan migrate</code></pre>
                            </div>
                            <div class="code-block">
<pre><code class="language-php">// Fetch notifications
$list = auth()->user()->notifications;          // all
$unread = auth()->user()->unreadNotifications;  // unread only

// Mark as read
$notification->markAsRead();
auth()->user()->unreadNotifications->markAsRead();</code></pre>
                            </div>
                            <div class="arabic-explain">
                                <strong>ليه Database؟</strong>
                                <p>علشان تعمل Inbox جوه التطبيق، وتدي المستخدم كنترول يمسح ويعلم كمقروء.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- On-demand, Routing, Localization -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingRouting">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRouting" aria-expanded="false" aria-controls="collapseRouting">
                            On-demand notifications, routing, and localization
                        </button>
                    </h2>
                    <div id="collapseRouting" class="accordion-collapse collapse" aria-labelledby="headingRouting" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">use Illuminate\Support\Facades\Notification;

Notification::route('mail', 'guest@example.com')
    ->route('vonage', '+201234567890')
    ->notify(new InvoicePaid());

// Localization
$user->notify((new InvoicePaid())->locale('ar'));
app()->setLocale('ar');</code></pre>
                            </div>
                            <div class="arabic-explain">
                                <strong>On-demand؟</strong>
                                <p>تبعِت لشخص مش مسجّل أصلاً، زي عميل ضيف حابب وصله إيميل مرة واحدة.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Throttling, Filtering, Security -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThrottle">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThrottle" aria-expanded="false" aria-controls="collapseThrottle">
                            Throttling, conditional delivery, and security
                        </button>
                    </h2>
                    <div id="collapseThrottle" class="accordion-collapse collapse" aria-labelledby="headingThrottle" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// Conditional channel selection
public function via($notifiable)
{
    $channels = ['database'];
    if ($notifiable->wants_mail) $channels[] = 'mail';
    return $channels;
}

// Simple throttling (custom logic)
if ($notifiable->last_notified_at && now()->diffInMinutes($notifiable->last_notified_at) < 5) {
    return; // skip
}</code></pre>
                            </div>
                            <div class="arabic-explain">
                                <strong>الأمان والمحتوى الحساس</strong>
                                <p>بلاش تبعت معلومات حساسة في الإشعار نفسه. استخدم روابط آمنة وصفحات محمية لعرض التفاصيل.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Testing -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTest">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTest" aria-expanded="false" aria-controls="collapseTest">
                            Testing with Notification::fake
                        </button>
                    </h2>
                    <div id="collapseTest" class="accordion-collapse collapse" aria-labelledby="headingTest" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">use Illuminate\Support\Facades\Notification;

Notification::fake();

// ...act

Notification::assertSentTo($user, InvoicePaid::class, function ($notification, $channels) use ($user) {
    return in_array('mail', $channels, true);
});</code></pre>
                            </div>
                            <div class="arabic-explain">
                                <strong>ليه بنفك الإرسال في التست؟</strong>
                                <p>علشان نتاكد إن السيستم نادى على الإشعار صح، من غير ما نبعت فعلياً لأي خدمة خارجية.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="100">
            <h2 class="section-title"><i class="fas fa-user-friends me-2"></i>Real-life Analogies</h2>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="analogy-card">
                        <h6><i class="fas fa-mail-bulk me-2"></i>Multi-channel</h6>
                        <p>زي شركة شحن بتختار وسيلة التوصيل: سريع (SMS)، اقتصادي (Mail)، أو داخل الشركة (Database).</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="analogy-card">
                        <h6><i class="fas fa-language me-2"></i>Localization</h6>
                        <p>زي موظف خدمة عملاء بيتكلم لغتك. السيستم يضبط رسالة تناسب لغة المستخدم.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="150">
            <h2 class="section-title"><i class="fas fa-user-tie me-2"></i>Advanced Developer Tips</h2>
            <ul class="tips-list">
                <li>Queue notifications and set <code>$afterCommit</code> on listeners if reading committed data.</li>
                <li>Use per-user preferences to dynamically choose channels and locales.</li>
                <li>For high-volume, separate queues per channel and scale workers independently.</li>
                <li>Mask sensitive values and prefer links with short-lived signed URLs.</li>
            </ul>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="200">
            <h2 class="section-title"><i class="fas fa-project-diagram me-2"></i>Mini Project: Billing Center</h2>
            <p>Implement a billing notification center: invoice issued, payment failed, payment received.</p>
            <ul>
                <li>Users choose channels (mail/database/SMS).</li>
                <li>Use markdown mails for branded layout.</li>
                <li>Persist to database for an in-app notification center.</li>
            </ul>
            <div class="code-block">
<pre><code class="language-bash">php artisan make:notification PaymentFailed
php artisan notifications:table && php artisan migrate</code></pre>
            </div>
            <div class="arabic-explain">
                <strong>فايدة مركز الإشعارات؟</strong>
                <p>المستخدم يلاقي كل الرسائل في مكان واحد، يراجع التاريخ، ويظبط تفضيلاته من غير دوشة.</p>
            </div>
        </section>

        <section class="mb-5" id="quiz" data-aos="fade-up" data-aos-delay="250">
            <h2 class="section-title"><i class="fas fa-question-circle me-2"></i>Interactive Quiz</h2>
            <form id="quizForm" class="quiz-form">
                <div class="quiz-question">
                    <p><strong>1.</strong> How do you enable in-app notification storage?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="a" id="q1a"><label class="form-check-label" for="q1a">Publish mail views</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="b" id="q1b"><label class="form-check-label" for="q1b">Run <code>notifications:table</code> and migrate</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="c" id="q1c"><label class="form-check-label" for="q1c">Enable Telescope</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>2.</strong> What does <code>ShouldQueue</code> do in a Notification?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="a" id="q2a"><label class="form-check-label" for="q2a">Sends immediately</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="b" id="q2b"><label class="form-check-label" for="q2b">Queues the notification</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="c" id="q2c"><label class="form-check-label" for="q2c">Changes locale</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>3.</strong> How do you route a Slack notification?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="a" id="q3a"><label class="form-check-label" for="q3a">Use <code>routeNotificationForSlack</code> on the Notifiable</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="b" id="q3b"><label class="form-check-label" for="q3b">Set <code>SLACK_WEBHOOK</code> in .env only</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="c" id="q3c"><label class="form-check-label" for="q3c">You cannot route Slack</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>4.</strong> What’s the benefit of on-demand notifications?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="a" id="q4a"><label class="form-check-label" for="q4a">Send to non-registered recipients</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="b" id="q4b"><label class="form-check-label" for="q4b">Speed up database</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="c" id="q4c"><label class="form-check-label" for="q4c">Force all channels</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>5.</strong> Which is a good security practice?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="a" id="q5a"><label class="form-check-label" for="q5a">Include full card numbers in SMS</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="b" id="q5b"><label class="form-check-label" for="q5b">Mask sensitive data; use signed links</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="c" id="q5c"><label class="form-check-label" for="q5c">Store secrets in notification body</label></div>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <button type="button" id="submitQuiz" class="btn btn-primary"><i class="fas fa-paper-plane me-2"></i>Submit</button>
                    <div id="quizResult" class="quiz-result" aria-live="polite"></div>
                </div>
            </form>
        </section>
    </main>

    <footer class="footer mt-5 py-4">
        <div class="container text-center">
            <p>&copy; 2024 Youssef Khaled. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/php.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>
    <script src="js/lecture-notifications.js"></script>
</body>
</html>

