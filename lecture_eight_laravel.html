<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Rate Limiting & Throttling | Laravel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/4f50f622f4.js" crossorigin="anonymous"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="css/lecture-api-rate-limiting.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html"><i class="fa-solid fa-code me-2"></i>Youssef Khaled</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><i class="fa-solid fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html"><i class="fa-solid fa-home me-1"></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="learning.html"><i class="fa-solid fa-graduation-cap me-1"></i>Learning</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="lecture-hero">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html" class="text-white-50">Home</a></li>
                    <li class="breadcrumb-item"><a href="learning.html" class="text-white-50">Learning Tracks</a></li>
                    <li class="breadcrumb-item active text-white" aria-current="page">API Rate Limiting</li>
                </ol>
            </nav>
            <h1 class="display-5 fw-bold">API Rate Limiting & Throttling</h1>
            <p class="lead mb-4">Control API access, prevent abuse, and ensure fair usage with Laravel’s rate limiting and throttling features. Includes advanced strategies and a practical project.</p>
            <div class="d-flex flex-wrap gap-2 align-items-center">
                <span class="badge rounded-pill bg-info-subtle text-info"><i class="fas fa-signal me-1"></i>Difficulty: Intermediate</span>
                <span class="badge rounded-pill bg-warning-subtle text-warning"><i class="fas fa-clock me-1"></i>Duration: 45 min</span>
                <span class="badge rounded-pill bg-success-subtle text-success"><i class="fas fa-tachometer-alt me-1"></i>API</span>
                <button id="markCompletedBtn" class="btn btn-outline-light ms-auto"><i class="far fa-check-circle me-2"></i>Mark as Completed</button>
            </div>
        </div>
    </header>

    <main class="container content-container">
        <section class="mb-5" data-aos="fade-up">
            <h2 class="section-title"><i class="fas fa-info-circle me-2"></i>Introduction</h2>
            <p>APIs are the backbone of modern applications. Without proper rate limiting, your API can be abused, leading to downtime, high costs, or security issues. Laravel provides powerful tools to control and monitor API usage.</p>
            <div class="arabic-explain">
                <strong>يعني إيه Rate Limiting؟</strong>
                <p>زي ما تحط بواب على باب الشركة: كل واحد ليه عدد مرات دخول معين في اليوم.</p>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="50">
            <h2 class="section-title"><i class="fas fa-layer-group me-2"></i>Main Concepts</h2>
            <div class="accordion" id="conceptsAccordion">
                <!-- Basic Rate Limiting -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingBasic">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBasic" aria-expanded="true" aria-controls="collapseBasic">
                            Basic Rate Limiting in Laravel
                        </button>
                    </h2>
                    <div id="collapseBasic" class="accordion-collapse collapse show" aria-labelledby="headingBasic" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// routes/api.php
Route::middleware('throttle:60,1')->get('/user', function () {
    return Auth::user();
});
// 60 requests per minute per user/IP</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Use the <code>throttle</code> middleware to limit requests.</li>
                                <li>Default: 60 requests per minute per user/IP.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>ليه الرقم مهم؟</strong>
                                <p>عشان متخليش حد يضغط على السيرفر أو يعمل هجوم.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Custom Rate Limiters -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingCustom">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCustom" aria-expanded="false" aria-controls="collapseCustom">
                            Custom Rate Limiters & Dynamic Rules
                        </button>
                    </h2>
                    <div id="collapseCustom" class="accordion-collapse collapse" aria-labelledby="headingCustom" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// app/Providers/RouteServiceProvider.php
use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Support\Facades\RateLimiter;

public function boot()
{
    RateLimiter::for('api', function ($request) {
        return Limit::perMinute(100)->by($request->user()?->id ?: $request->ip());
    });
}</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Define custom rate limiters for different routes or users.</li>
                                <li>Use user ID, IP, or even roles for dynamic limits.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>ممكن تفرق بين المستخدمين؟</strong>
                                <p>آه، ممكن تخلي VIP ليهم حد أعلى، أو تمنع سبام من IP معين.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Throttling Strategies -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThrottle">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThrottle" aria-expanded="false" aria-controls="collapseThrottle">
                            Throttling Strategies & Burst Control
                        </button>
                    </h2>
                    <div id="collapseThrottle" class="accordion-collapse collapse" aria-labelledby="headingThrottle" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// Allow bursts, then slow down
Limit::perMinute(60)->response(function() {
    return response('Too many requests!', 429);
});</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Control bursts (many requests in a short time) and set custom responses.</li>
                                <li>Return custom error messages or headers for clients.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>ليه أوقات بتسمح بBurst؟</strong>
                                <p>عشان المستخدم الطبيعي ساعات يضغط بسرعة، لكن لو استمر لازم توقفه.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Global vs. Route-Specific Limits -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingGlobal">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGlobal" aria-expanded="false" aria-controls="collapseGlobal">
                            Global vs. Route-Specific Limits
                        </button>
                    </h2>
                    <div id="collapseGlobal" class="accordion-collapse collapse" aria-labelledby="headingGlobal" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// In RouteServiceProvider or middleware
RateLimiter::for('uploads', function ($request) {
    return Limit::perMinute(10)->by($request->user()?->id ?: $request->ip());
});

Route::middleware('throttle:uploads')->post('/upload', ...);</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Apply different limits to different endpoints (e.g., uploads vs. reads).</li>
                                <li>Fine-tune API protection for business needs.</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- Monitoring & Abuse Detection -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingMonitor">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMonitor" aria-expanded="false" aria-controls="collapseMonitor">
                            Monitoring, Logging & Abuse Detection
                        </button>
                    </h2>
                    <div id="collapseMonitor" class="accordion-collapse collapse" aria-labelledby="headingMonitor" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// Log abuse attempts
if ($request->isThrottled()) {
    Log::warning('Throttling triggered', ['ip' => $request->ip()]);
}</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Monitor logs for repeated abuse or attacks.</li>
                                <li>Integrate with alerting/monitoring tools for real-time response.</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="100">
            <h2 class="section-title"><i class="fas fa-user-friends me-2"></i>Real-life Analogies</h2>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="analogy-card">
                        <h6><i class="fas fa-tachometer-alt me-2"></i>Speed Bumps</h6>
                        <p>زي مطبّات السرعة: بتبطّأ العربيات عشان متعملش حوادث أو تضر الطريق.</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="analogy-card">
                        <h6><i class="fas fa-user-shield me-2"></i>Security Guards</h6>
                        <p>كل بوابة عليها حارس، مينفعش تعدي أكتر من عدد معين في وقت قصير.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="150">
            <h2 class="section-title"><i class="fas fa-user-tie me-2"></i>Advanced Developer Tips</h2>
            <ul class="tips-list">
                <li>Use Redis or Memcached for distributed rate limiting in multi-server setups.</li>
                <li>Customize error responses for better API UX.</li>
                <li>Whitelist trusted IPs or users for higher limits.</li>
                <li>Log and alert on repeated abuse attempts.</li>
                <li>Document all rate limits for your API consumers.</li>
            </ul>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="200">
            <h2 class="section-title"><i class="fas fa-project-diagram me-2"></i>Mini Project: Secure File Upload API</h2>
            <p>Build a file upload API with strict rate limits: 10 uploads/minute per user, custom error messages, and abuse logging. Add a dashboard to monitor usage and block abusers.</p>
            <div class="code-block">
<pre><code class="language-php">// app/Providers/RouteServiceProvider.php
RateLimiter::for('uploads', function ($request) {
    return Limit::perMinute(10)->by($request->user()?->id ?: $request->ip())
        ->response(function() {
            return response('Upload limit reached. Try again later.', 429);
        });
});

// routes/api.php
Route::middleware('throttle:uploads')->post('/upload', ...);</code></pre>
            </div>
            <div class="arabic-explain">
                <strong>ليه لازم Dashboard؟</strong>
                <p>عشان تتابع الاستخدام وتمنع أي محاولة استغلال أو هجوم بسرعة.</p>
            </div>
        </section>

        <section class="mb-5" id="quiz" data-aos="fade-up" data-aos-delay="250">
            <h2 class="section-title"><i class="fas fa-question-circle me-2"></i>Interactive Quiz</h2>
            <form id="quizForm" class="quiz-form">
                <div class="quiz-question">
                    <p><strong>1.</strong> What does the throttle middleware do?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="a" id="q1a"><label class="form-check-label" for="q1a">Limits the number of requests per user/IP</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="b" id="q1b"><label class="form-check-label" for="q1b">Encrypts API data</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="c" id="q1c"><label class="form-check-label" for="q1c">Caches responses</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>2.</strong> How can you set different limits for different users?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="a" id="q2a"><label class="form-check-label" for="q2a">Custom rate limiters in RouteServiceProvider</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="b" id="q2b"><label class="form-check-label" for="q2b">Change .env file</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="c" id="q2c"><label class="form-check-label" for="q2c">You can't</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>3.</strong> What’s a good practice for distributed APIs?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="a" id="q3a"><label class="form-check-label" for="q3a">Use Redis/Memcached for rate limiting</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="b" id="q3b"><label class="form-check-label" for="q3b">Disable rate limiting</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="c" id="q3c"><label class="form-check-label" for="q3c">Use only IP addresses</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>4.</strong> How do you return a custom error message for throttled requests?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="a" id="q4a"><label class="form-check-label" for="q4a">Use the response() method on Limit</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="b" id="q4b"><label class="form-check-label" for="q4b">Edit the .env file</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="c" id="q4c"><label class="form-check-label" for="q4c">You can't</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>5.</strong> Why is monitoring important for APIs?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="a" id="q5a"><label class="form-check-label" for="q5a">To detect abuse and respond quickly</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="b" id="q5b"><label class="form-check-label" for="q5b">To slow down all users</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="c" id="q5c"><label class="form-check-label" for="q5c">No reason</label></div>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <button type="button" id="submitQuiz" class="btn btn-primary"><i class="fas fa-paper-plane me-2"></i>Submit</button>
                    <div id="quizResult" class="quiz-result" aria-live="polite"></div>
                </div>
            </form>
        </section>
    </main>

    <footer class="footer mt-5 py-4">
        <div class="container text-center">
            <p>&copy; 2024 Youssef Khaled. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/php.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>
    <script src="js/lecture-api-rate-limiting.js"></script>
</body>
</html>