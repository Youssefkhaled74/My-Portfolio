<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Policies & Gates | Advanced</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/4f50f622f4.js" crossorigin="anonymous"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="css/lecture-policies-gates.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html"><i class="fa-solid fa-code me-2"></i>Youssef Khaled</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><i class="fa-solid fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html"><i class="fa-solid fa-home me-1"></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="learning.html"><i class="fa-solid fa-graduation-cap me-1"></i>Learning</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="lecture-hero">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html" class="text-white-50">Home</a></li>
                    <li class="breadcrumb-item"><a href="learning.html" class="text-white-50">Learning Tracks</a></li>
                    <li class="breadcrumb-item active text-white" aria-current="page">Policies & Gates</li>
                </ol>
            </nav>
            <h1 class="display-5 fw-bold">Laravel Policies & Gates (Advanced)</h1>
            <p class="lead mb-4">Master advanced authorization in Laravel: dynamic policies, complex gate logic, multi-tenant security, custom responses, and real-world scenarios.</p>
            <div class="d-flex flex-wrap gap-2 align-items-center">
                <span class="badge rounded-pill bg-info-subtle text-info"><i class="fas fa-signal me-1"></i>Difficulty: Advanced</span>
                <span class="badge rounded-pill bg-warning-subtle text-warning"><i class="fas fa-clock me-1"></i>Duration: 60 min</span>
                <span class="badge rounded-pill bg-success-subtle text-success"><i class="fas fa-lock me-1"></i>Authorization</span>
                <button id="markCompletedBtn" class="btn btn-outline-light ms-auto"><i class="far fa-check-circle me-2"></i>Mark as Completed</button>
            </div>
        </div>
    </header>

    <main class="container content-container">
        <section class="mb-5" data-aos="fade-up">
            <h2 class="section-title"><i class="fas fa-info-circle me-2"></i>Introduction</h2>
            <p>Laravel’s authorization system is powerful and flexible. In this advanced lecture, we’ll go beyond the basics to cover dynamic policies, advanced gate logic, multi-tenant security, custom responses, and real-world scenarios.</p>
            <div class="arabic-explain">
                <strong>يعني إيه Authorization متقدم؟</strong>
                <p>مش بس مين يدخل، لكن كمان مين يعمل إيه، وإزاي تتحكم في كل حالة معقدة في التطبيق.</p>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="50">
            <h2 class="section-title"><i class="fas fa-layer-group me-2"></i>Main Concepts</h2>
            <div class="accordion" id="conceptsAccordion">
                <!-- Dynamic Policies -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingDynamic">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDynamic" aria-expanded="true" aria-controls="collapseDynamic">
                            Dynamic Policies & Contextual Authorization
                        </button>
                    </h2>
                    <div id="collapseDynamic" class="accordion-collapse collapse show" aria-labelledby="headingDynamic" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// app/Policies/DocumentPolicy.php
public function update(User $user, Document $doc)
{
    // Allow if user owns the document or is an admin for the doc's team
    return $user->id === $doc->user_id || $user->hasTeamRole($doc->team_id, 'admin');
}</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Policies can use any business logic, not just simple ownership.</li>
                                <li>Inject context: teams, roles, or even request data.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>ليه مش شرط يكون Owner؟</strong>
                                <p>ممكن مدير الفريق يعدّل، مش بس صاحب الملف.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Gates -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingGates">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGates" aria-expanded="false" aria-controls="collapseGates">
                            Advanced Gates: Complex Logic & Inline Checks
                        </button>
                    </h2>
                    <div id="collapseGates" class="accordion-collapse collapse" aria-labelledby="headingGates" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">Gate::define('edit-settings', function (User $user) {
    return $user->isSuperAdmin() || ($user->hasPermission('settings.edit') && $user->active);
});

if (Gate::allows('edit-settings')) {
    // ...
}</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Gates can combine multiple conditions, permissions, and user states.</li>
                                <li>Use gates for one-off or cross-cutting rules.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>Gate مش بس للسياسات العامة</strong>
                                <p>ينفع تربط أكتر من شرط مع بعض، زي صلاحيات خاصة أو حالات المستخدم.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Multi-Tenancy & Scoped Policies -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTenant">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTenant" aria-expanded="false" aria-controls="collapseTenant">
                            Multi-Tenancy & Scoped Authorization
                        </button>
                    </h2>
                    <div id="collapseTenant" class="accordion-collapse collapse" aria-labelledby="headingTenant" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// Only allow actions within the user's tenant
public function view(User $user, Project $project)
{
    return $user->tenant_id === $project->tenant_id;
}</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Always scope access to the user’s tenant or organization.</li>
                                <li>Prevents data leaks between companies or clients.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>ليه لازم تربط بالTenant؟</strong>
                                <p>عشان كل شركة أو عميل يشوف بياناته بس.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Custom Responses & Messages -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingCustom">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCustom" aria-expanded="false" aria-controls="collapseCustom">
                            Custom Responses & Error Messages
                        </button>
                    </h2>
                    <div id="collapseCustom" class="accordion-collapse collapse" aria-labelledby="headingCustom" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// In a policy method
return Response::deny('You must be a team admin to delete this.');

// In controller
$this->authorize('delete', $doc); // Throws AuthorizationException with custom message</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Return custom denial messages for better UX and debugging.</li>
                                <li>Handle exceptions globally for consistent API/UI feedback.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>ليه الرسالة مهمة؟</strong>
                                <p>عشان المستخدم أو المطور يعرف السبب الحقيقي للرفض.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Policy Auto-Discovery & Registration -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingAuto">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAuto" aria-expanded="false" aria-controls="collapseAuto">
                            Policy Auto-Discovery & Registration
                        </button>
                    </h2>
                    <div id="collapseAuto" class="accordion-collapse collapse" aria-labelledby="headingAuto" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// Laravel auto-discovers policies if you follow naming conventions
// e.g., PostPolicy for Post model in app/Policies
// Manual registration (if needed):
protected $policies = [
    Post::class => PostPolicy::class,
];</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Follow conventions for auto-discovery, or register manually for custom cases.</li>
                                <li>Keeps your codebase organized and scalable.</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="100">
            <h2 class="section-title"><i class="fas fa-user-friends me-2"></i>Real-life Analogies</h2>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="analogy-card">
                        <h6><i class="fas fa-key me-2"></i>Keys & Permissions</h6>
                        <p>زي مفاتيح الشركة: كل موظف ليه مفتاح يفتح أوضة معينة، والمدير معاه مفاتيح أكتر.</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="analogy-card">
                        <h6><i class="fas fa-users-cog me-2"></i>Roles & Teams</h6>
                        <p>كل فريق ليه صلاحياته، وممكن المدير يعدّل على كل الفرق.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="150">
            <h2 class="section-title"><i class="fas fa-user-tie me-2"></i>Advanced Developer Tips</h2>
            <ul class="tips-list">
                <li>Use policies for model-based logic, gates for global or cross-cutting rules.</li>
                <li>Centralize permission checks for maintainability.</li>
                <li>Test policies and gates with feature and unit tests.</li>
                <li>Leverage custom responses for better API error handling.</li>
                <li>Document all authorization rules for your team.</li>
                <li>For multi-tenant apps, always scope by tenant/org ID.</li>
            </ul>
        </section>

        <section class="mb-5" data-aos="fade-up" data-aos-delay="200">
            <h2 class="section-title"><i class="fas fa-project-diagram me-2"></i>Mini Project: Multi-Tenant Document Management</h2>
            <p>Build a document management system where users can only view, edit, or delete documents within their own company. Admins can manage all documents in their company, but not in others. Add custom denial messages and test all edge cases.</p>
            <div class="code-block">
<pre><code class="language-php">// app/Policies/DocumentPolicy.php
public function delete(User $user, Document $doc)
{
    if ($user->tenant_id !== $doc->tenant_id) {
        return Response::deny('You cannot delete documents outside your company.');
    }
    if ($user->role === 'admin' || $user->id === $doc->user_id) {
        return true;
    }
    return Response::deny('Only admins or owners can delete this document.');
}</code></pre>
            </div>
            <div class="arabic-explain">
                <strong>ليه لازم تختبر كل حالة؟</strong>
                <p>عشان لو فيه ثغرة، ممكن حد يشوف أو يعدّل بيانات مش من حقه.</p>
            </div>
        </section>

        <section class="mb-5" id="quiz" data-aos="fade-up" data-aos-delay="250">
            <h2 class="section-title"><i class="fas fa-question-circle me-2"></i>Interactive Quiz</h2>
            <form id="quizForm" class="quiz-form">
                <div class="quiz-question">
                    <p><strong>1.</strong> What’s the main difference between a policy and a gate?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="a" id="q1a"><label class="form-check-label" for="q1a">Policy is for models, gate is for general rules</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="b" id="q1b"><label class="form-check-label" for="q1b">Gate is for models, policy is for global</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="c" id="q1c"><label class="form-check-label" for="q1c">They are the same</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>2.</strong> How do you provide a custom denial message in a policy?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="a" id="q2a"><label class="form-check-label" for="q2a">Return Response::deny('message')</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="b" id="q2b"><label class="form-check-label" for="q2b">Throw new Exception()</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="c" id="q2c"><label class="form-check-label" for="q2c">Return false</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>3.</strong> What’s a best practice for multi-tenant authorization?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="a" id="q3a"><label class="form-check-label" for="q3a">Always check tenant/org ID</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="b" id="q3b"><label class="form-check-label" for="q3b">Allow all admins everywhere</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="c" id="q3c"><label class="form-check-label" for="q3c">Ignore tenant for speed</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>4.</strong> How do you test a policy in Laravel?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="a" id="q4a"><label class="form-check-label" for="q4a">With feature/unit tests using $this->actingAs()</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="b" id="q4b"><label class="form-check-label" for="q4b">By checking the database only</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="c" id="q4c"><label class="form-check-label" for="q4c">You can’t test policies</label></div>
                </div>
                <div class="quiz-question">
                    <p><strong>5.</strong> What’s the benefit of custom error messages in authorization?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="a" id="q5a"><label class="form-check-label" for="q5a">Better UX and easier debugging</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="b" id="q5b"><label class="form-check-label" for="q5b">No benefit</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="c" id="q5c"><label class="form-check-label" for="q5c">Slower performance</label></div>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <button type="button" id="submitQuiz" class="btn btn-primary"><i class="fas fa-paper-plane me-2"></i>Submit</button>
                    <div id="quizResult" class="quiz-result" aria-live="polite"></div>
                </div>
            </form>
        </section>
    </main>

    <footer class="footer mt-5 py-4">
        <div class="container text-center">
            <p>&copy; 2024 Youssef Khaled. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/php.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>
    <script src="js/lecture-policies-gates.js"></script>
</body>
</html>