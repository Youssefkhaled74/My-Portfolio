<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Authentication & Authorization | Learning Track</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/4f50f622f4.js" crossorigin="anonymous"></script>
    <!-- AOS for Animations -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Highlight.js theme -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/atom-one-dark.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/lecture-auth.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
            <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fa-solid fa-code me-2"></i>Youssef Khaled
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="fa-solid fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html"><i class="fa-solid fa-home me-1"></i>Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="learning.html"><i class="fa-solid fa-graduation-cap me-1"></i>Learning</a>
                    </li>
                </ul>
            </div>
                </div>
    </nav>

    <!-- Hero / Header -->
    <header class="lecture-hero">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html" class="text-white-50">Home</a></li>
                    <li class="breadcrumb-item"><a href="learning.html" class="text-white-50">Learning Tracks</a></li>
                    <li class="breadcrumb-item active text-white" aria-current="page">Authentication & Authorization</li>
                </ol>
            </nav>
            <h1 class="display-5 fw-bold">Authentication & Authorization in Laravel</h1>
            <p class="lead mb-4">Build secure applications using Laravel Breeze, Sanctum, and advanced permission systems. Real examples, hands-on steps, and a final mini-project.</p>
            <div class="d-flex flex-wrap gap-2 align-items-center">
                <span class="badge rounded-pill bg-info-subtle text-info"><i class="fas fa-signal me-1"></i>Difficulty: Advanced</span>
                <span class="badge rounded-pill bg-warning-subtle text-warning"><i class="fas fa-clock me-1"></i>Duration: 60 min</span>
                <span class="badge rounded-pill bg-success-subtle text-success"><i class="fas fa-shield-alt me-1"></i>Security</span>
                <span class="badge rounded-pill bg-primary-subtle text-primary"><i class="fas fa-plug me-1"></i>API</span>
                <button id="markCompletedBtn" class="btn btn-outline-light ms-auto"><i class="far fa-check-circle me-2"></i>Mark as Completed</button>
                </div>
            </div>
        </header>

    <main class="container content-container">
        <!-- Introduction -->
        <section class="mb-5" data-aos="fade-up">
            <h2 class="section-title"><i class="fas fa-info-circle me-2"></i>Introduction</h2>
            <p>
                In this lecture, you will scaffold auth with Breeze, secure APIs with Sanctum, and implement fine-grained access control using Gates and Policies. We will finish with a mini-project that ties everything together.
            </p>
            </section>

        <!-- Main Concepts -->
        <section class="mb-5" data-aos="fade-up" data-aos-delay="50">
            <h2 class="section-title"><i class="fas fa-layer-group me-2"></i>Main Concepts</h2>
            <div class="accordion" id="conceptsAccordion">
                <!-- Breeze -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingBreeze">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBreeze" aria-expanded="true" aria-controls="collapseBreeze">
                            Laravel Breeze for scaffolding authentication
                        </button>
                </h2>
                    <div id="collapseBreeze" class="accordion-collapse collapse show" aria-labelledby="headingBreeze" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <p>Use Breeze to quickly scaffold login, registration, password reset, and email verification.</p>
                            <div class="code-block">
                                <pre><code class="language-bash"># Install Breeze
composer require laravel/breeze --dev
php artisan breeze:install blade
npm install && npm run build
php artisan migrate</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li><code>composer require</code>: add Breeze to dev dependencies.</li>
                                <li><code>breeze:install blade</code>: scaffold Blade auth views and routes.</li>
                                <li><code>npm install</code> then <code>npm run build</code>: compile frontend assets.</li>
                                <li><code>php artisan migrate</code>: create users and auth-related tables.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>يعني إيه Authentication؟</strong>
                                <p>تخيل إنك داخل مبنى الشركة. أول خطوة هي الاستقبال اللي بيتأكد إنك موظف حقيقي. ده هو الـ Authentication: التحقق إن الشخص ده هو فعلاً هو.</p>
                            </div>
                            </div>
                        </div>
                    </div>
                <!-- Sanctum -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingSanctum">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSanctum" aria-expanded="false" aria-controls="collapseSanctum">
                            Sanctum for API token-based authentication
                        </button>
                    </h2>
                    <div id="collapseSanctum" class="accordion-collapse collapse" aria-labelledby="headingSanctum" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <p>Sanctum issues first-party SPA sessions and API tokens with abilities.</p>
                            <div class="code-block">
<pre><code class="language-php">// routes/api.php
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;

Route::post('/tokens/create', function (Request $request) {
    $user = \App\Models\User::where('email', $request->email)->firstOrFail();
    abort_unless(\Hash::check($request->password, $user->password), 401);

    $token = $user->createToken('api', ['posts:read', 'posts:write']);
    return ['token' => $token->plainTextToken];
});

Route::middleware('auth:sanctum')->get('/me', function (Request $request) {
    return $request->user();
});</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Find user by email; fail if not found.</li>
                                <li>Validate password with <code>Hash::check</code>.</li>
                                <li>Create a scoped token with abilities.</li>
                                <li>Return the plain-text token to the client.</li>
                                <li>Secure <code>/me</code> using <code>auth:sanctum</code>.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>يعني إيه Token؟</strong>
                                <p>تخيل معاك كارت موظف عليه صلاحياتك. الكارت ده هو الـ Token، و"الـ abilities" اللي عليه زي الأختام اللي بتحدد إنت مسموحلك تعمل إيه.</p>
                            </div>
                            </div>
                        </div>
                    </div>
                <!-- Roles/Permissions -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingPolicies">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePolicies" aria-expanded="false" aria-controls="collapsePolicies">
                            Role and permission systems with Gates and Policies
                        </button>
                    </h2>
                    <div id="collapsePolicies" class="accordion-collapse collapse" aria-labelledby="headingPolicies" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <p>Use Gates for simple checks and Policies for model-level authorization.</p>
                            <div class="code-block">
<pre><code class="language-php">// app/Providers/AuthServiceProvider.php
use Illuminate\Support\Facades\Gate;

public function boot(): void
{
    Gate::define('posts.manage', function ($user) {
        return $user->role === 'admin';
    });
}</code></pre>
                        </div>
                            <div class="code-block">
<pre><code class="language-php">// app/Policies/PostPolicy.php
namespace App\Policies;

use App\Models\Post;
use App\Models\User;

class PostPolicy
{
    public function update(User $user, Post $post): bool
    {
        return $user->id === $post->user_id || $user->role === 'editor';
    }
}</code></pre>
                            </div>
                            <div class="code-block">
<pre><code class="language-php">// app/Providers/AuthServiceProvider.php
protected $policies = [
    \App\Models\Post::class => \App\Policies\PostPolicy::class,
];</code></pre>
                            </div>
                            <ol class="explain-list">
                                <li>Define <code>posts.manage</code> gate for admin-only actions.</li>
                                <li>Authorize post updates for owners and editors via policy.</li>
                                <li>Register the policy mapping in <code>AuthServiceProvider</code>.</li>
                            </ol>
                            <div class="arabic-explain">
                                <strong>يعني إيه Policy؟</strong>
                                <p>تخيل لائحة داخل الشركة بتقول مين يقدر يعدّل على المستندات. الـ Policy دي بتحط القواعد دي في مكان واحد بعيد عن الكنترولر علشان الكود يبقى أنضف وأسهل في الاختبار.</p>
                            </div>
                            <div class="arabic-explain">
                                <strong>يعني إيه Middleware؟</strong>
                                <p>زي بوابة الأمن عند مدخل الدور. أي طلب لازم يعدّي عليها الأول. لو معاك تصريح (متوثّق)، بتعدّي؛ غير كده بترجع.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Protecting Routes -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingRoutes">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRoutes" aria-expanded="false" aria-controls="collapseRoutes">
                            Protecting routes and securing access
                        </button>
                </h2>
                    <div id="collapseRoutes" class="accordion-collapse collapse" aria-labelledby="headingRoutes" data-bs-parent="#conceptsAccordion">
                        <div class="accordion-body">
                            <div class="code-block">
<pre><code class="language-php">// routes/web.php
Route::middleware(['auth'])->group(function () {
    Route::get('/dashboard', [DashboardController::class, 'index']);
    Route::post('/posts/{post}', [PostController::class, 'update'])->middleware('can:update,post');
});</code></pre>
                        </div>
                            <ol class="explain-list">
                                <li>Require login for the group via <code>auth</code> middleware.</li>
                                <li>Enforce <code>PostPolicy@update</code> using <code>can:update,post</code>.</li>
                                        </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        <!-- Real-life Analogies -->
        <section class="mb-5" data-aos="fade-up" data-aos-delay="100">
            <h2 class="section-title"><i class="fas fa-user-friends me-2"></i>Real-life Analogies</h2>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="analogy-card">
                        <h6><i class="fas fa-id-card me-2"></i>Sanctum Tokens</h6>
                        <p>Like an ID badge with specific access floors; abilities are the floors you can access.</p>
                                    </div>
                                </div>
                <div class="col-md-6">
                    <div class="analogy-card">
                        <h6><i class="fas fa-balance-scale me-2"></i>Policies</h6>
                        <p>Company policy handbook that defines who is allowed to do what with a document.</p>
                                    </div>
                                    </div>
                                </div>
        </section>

        <!-- Advanced Tips -->
        <section class="mb-5" data-aos="fade-up" data-aos-delay="150">
            <h2 class="section-title"><i class="fas fa-user-tie me-2"></i>Advanced Developer Tips</h2>
            <ul class="tips-list">
                <li>Scope Sanctum tokens with least-privilege abilities; rotate regularly.</li>
                <li>Cache Gate checks if they depend on expensive queries.</li>
                <li>Use <code>Gate::before</code> for super-admin bypass in one place.</li>
                <li>Avoid storing tokens in localStorage for SPAs; prefer HttpOnly cookies.</li>
            </ul>
        </section>

        <!-- Mini Project -->
        <section class="mb-5" data-aos="fade-up" data-aos-delay="200">
            <h2 class="section-title"><i class="fas fa-project-diagram me-2"></i>Mini Project: Role-based Blog</h2>
            <p>Build a blog with roles: <strong>admin</strong>, <strong>editor</strong>, <strong>author</strong>, and <strong>reader</strong>.</p>
            <ul>
                <li>Admins manage users and posts (Gate: <code>posts.manage</code>).</li>
                <li>Editors can update any post; authors can update only their posts (Policy: <code>update</code>).</li>
                <li>API endpoints protected with Sanctum tokens and abilities.</li>
            </ul>
            <div class="code-block">
<pre><code class="language-bash"># Hints
php artisan make:policy PostPolicy --model=Post
php artisan make:middleware EnsureUserRole
php artisan make:controller Api/PostController --api</code></pre>
                                    </div>
        </section>

        <!-- Interactive Quiz -->
        <section class="mb-5" id="quiz" data-aos="fade-up" data-aos-delay="250">
            <h2 class="section-title"><i class="fas fa-question-circle me-2"></i>Interactive Quiz</h2>
            <form id="quizForm" class="quiz-form">
                <div class="quiz-question">
                    <p><strong>1.</strong> What does Laravel Sanctum primarily provide?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="a" id="q1a"><label class="form-check-label" for="q1a">OAuth2 authorization server</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="b" id="q1b"><label class="form-check-label" for="q1b">API tokens and SPA authentication</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="c" id="q1c"><label class="form-check-label" for="q1c">Session encryption</label></div>
                                    </div>
                <div class="quiz-question">
                    <p><strong>2.</strong> Which is best for model-level authorization?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="a" id="q2a"><label class="form-check-label" for="q2a">Middleware</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="b" id="q2b"><label class="form-check-label" for="q2b">Gates</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="c" id="q2c"><label class="form-check-label" for="q2c">Policies</label></div>
                                </div>
                <div class="quiz-question">
                    <p><strong>3.</strong> How do you protect an API route with Sanctum?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="a" id="q3a"><label class="form-check-label" for="q3a">Use middleware <code>auth:sanctum</code></label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="b" id="q3b"><label class="form-check-label" for="q3b">Use middleware <code>verified</code></label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="c" id="q3c"><label class="form-check-label" for="q3c">No middleware required</label></div>
                            </div>
                <div class="quiz-question">
                    <p><strong>4.</strong> Which statement about Gates is true?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="a" id="q4a"><label class="form-check-label" for="q4a">They must reference a specific Eloquent model</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="b" id="q4b"><label class="form-check-label" for="q4b">They can be used for general ability checks</label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="c" id="q4c"><label class="form-check-label" for="q4c">They only work in Blade templates</label></div>
                        </div>
                <div class="quiz-question">
                    <p><strong>5.</strong> Where do you register a Policy?</p>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="a" id="q5a"><label class="form-check-label" for="q5a">In <code>RouteServiceProvider</code></label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="b" id="q5b"><label class="form-check-label" for="q5b">In <code>AuthServiceProvider</code></label></div>
                    <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="c" id="q5c"><label class="form-check-label" for="q5c">In the model file</label></div>
                    </div>
                <div class="d-flex align-items-center gap-3">
                    <button type="button" id="submitQuiz" class="btn btn-primary"><i class="fas fa-paper-plane me-2"></i>Submit</button>
                    <div id="quizResult" class="quiz-result" aria-live="polite"></div>
                </div>
            </form>
            </section>
        </main>

    <!-- Footer -->
    <footer class="footer mt-5 py-4">
            <div class="container text-center">
            <p>&copy; 2024 Youssef Khaled. All rights reserved.</p>
            </div>
        </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- AOS JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- Highlight.js core + PHP -->
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/php.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>
    <!-- Custom JS -->
    <script src="js/lecture-auth.js"></script>
</body>
</html>